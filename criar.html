<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ZedoLink</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* O CSS continua exatamente o mesmo, o design está mantido */
        :root {
            --header-bg: #2c2c3d; --body-bg: #f0f2f5; --form-bg: #ffffff;
            --primary-button-bg: #5cb85c; --primary-button-hover: #4cae4c;
            --secondary-button-bg: #337ab7; --edit-button-bg: #f0ad4e;
            --delete-button-bg: #d9534f; --text-dark: #333; --text-light: #fff;
            --border-color: #ddd; --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 6px;
        }
        body { font-family: Arial, sans-serif; background-color: var(--body-bg); color: var(--text-dark); margin: 0; }
        .header { background-color: var(--header-bg); padding: 15px 0; display: flex; align-items: center; }
        .header-container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 30px; }
        .header .logo img { height: 65px; }
        .main-container { display: flex; flex-wrap: wrap; gap: 30px; padding: 30px; max-width: 1200px; margin: auto; }
        .form-section { flex: 1; min-width: 350px; background-color: var(--form-bg); padding: 25px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); align-self: flex-start; }
        .links-section { flex: 1.5; min-width: 400px; }
        .form-section h2, .links-section h2 { font-size: 1.5rem; margin-top: 0; margin-bottom: 20px; }
        #formCriarLink input[type="url"] { width: calc(100% - 24px); padding: 12px; font-size: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: 15px; }
        #formCriarLink button { width: 100%; padding: 15px; font-size: 1.2rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-button-bg); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.2s; }
        #formCriarLink button:hover { background-color: var(--primary-button-hover); }
        #status-message { display: none; margin-top: 15px; padding: 15px; border-radius: var(--border-radius); text-align: center; font-weight: bold; }
        #status-message.success { background-color: #dff0d8; color: #3c763d; }
        #status-message.error { background-color: #f2dede; color: #a94442; }
        .link-item { background-color: var(--form-bg); border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .link-item-content { display: flex; flex-direction: column; gap: 10px; flex-grow: 1; }
        .link-item-meme img { width: 80px; height: 80px; border-radius: var(--border-radius); object-fit: cover; }
        .link-item .urls { display: flex; flex-direction: column; }
        .link-item .short-url a { font-weight: bold; color: var(--text-dark); text-decoration: none; font-size: 1.1rem; }
        .link-item .original-url { color: #6c757d; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 350px; }
        .link-item .link-actions { display: flex; flex-wrap: wrap; gap: 8px; border-top: 1px solid var(--border-color); padding-top: 10px; margin-top: 5px; }
        .link-actions button { padding: 6px 12px; font-size: 0.85rem; color: var(--text-light); border: none; border-radius: var(--border-radius); cursor: pointer; }
        .btn-edit { background-color: var(--edit-button-bg); }
        .btn-delete { background-color: var(--delete-button-bg); }
        .btn-copy, .btn-qr, .btn-share { background-color: var(--secondary-button-bg); }
    </style>
</head>
<body>

    <header class="header"> </header>
    <main class="main-container"> </main>
    <script>
        // --- 2. CONFIGURAÇÃO DA CONEXÃO COM O SUPABASE ---
        const SUPABASE_URL = 'https://rxqxvjxmpxwcsdxvumiz.supabase.co';
        const SUPABASE_ANON_KEY = 'COLE_SUA_CHAVE_ANON_PUBLIC_AQUI'; // <-- COLE SUA CHAVE AQUI

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- SELETORES DE ELEMENTOS ---
        const formCriarLink = document.getElementById('formCriarLink');
        const urlOriginalInput = document.getElementById('urlOriginal');
        const linksListaDiv = document.getElementById('links-lista');
        const submitButton = formCriarLink.querySelector('button');
        // ... (outros seletores que você já tem)

        const memeSequence = [
            'IMG/calmatrav.webp', 'IMG/homerdancando.webp', 'IMG/aicemequebra.webp',
            'IMG/meme 1.webp', 'IMG/gordinhodancando.jpeg', 'IMG/fe9d8ca4-7fdf-44f3-8dd8-ef4f6e4c3022.webp'
        ];

        // --- FUNÇÕES ---

        // FUNÇÃO PARA MOSTRAR OS LINKS (AGORA LENDO DO SUPABASE)
        async function renderizarLinks() {
            // Pede ao Supabase todos os links da tabela 'links', ordenados pelos mais recentes
            const { data: links, error } = await supabase
                .from('links')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Erro ao buscar links:', error);
                linksListaDiv.innerHTML = '<p style="color: red;">Erro ao carregar a lista de links.</p>';
                return;
            }

            linksListaDiv.innerHTML = '';
            if (links.length === 0) {
                linksListaDiv.innerHTML = '<p>Nenhum link criado ainda.</p>';
                return;
            }

            links.forEach(link => {
                const shortUrl = `${window.location.origin}/?id=${link.short_id}`;
                const linkElement = document.createElement('div');
                linkElement.className = 'link-item';
                // Usamos os nomes das colunas que criamos no Supabase
                linkElement.innerHTML = `
                    <div class="link-item-meme"> <img src="${link.meme_url}" alt="Meme"> </div>
                    <div class="link-item-content">
                        <div class="urls">
                            <span class="short-url"><a href="${shortUrl}" target="_blank">${shortUrl}</a></span>
                            <span class="original-url" title="${link.original_url}">Destino: ${link.original_url}</span>
                        </div>
                        <div class="link-actions">
                            <button class="btn-copy" data-url="${shortUrl}">Copiar</button>
                            <button class="btn-share" data-url="${shortUrl}">Share</button>
                            <button class="btn-qr" data-url="${shortUrl}">QR</button>
                            <button class="btn-edit" data-id="${link.id}" data-original-url="${link.original_url}">Editar</button>
                            <button class="btn-delete" data-id="${link.id}">Excluir</button>
                        </div>
                    </div>
                `;
                linksListaDiv.appendChild(linkElement);
            });
        }

        // FUNÇÃO PARA CRIAR UM NOVO LINK (AGORA SALVANDO NO SUPABASE)
        formCriarLink.addEventListener('submit', async function(event) {
            event.preventDefault();
            const urlParaEncurtar = urlOriginalInput.value;
            
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';

            try {
                // Prepara os dados para o novo link
                const short_id = Math.random().toString(36).substring(2, 8);
                const { data: countData } = await supabase.from('links').select('*', { count: 'exact', head: true });
                const memeIndex = countData.count % memeSequence.length;
                const meme_url = memeSequence[memeIndex];
                
                // Insere a nova linha na tabela 'links' do Supabase
                const { error } = await supabase
                    .from('links')
                    .insert({ 
                        short_id: short_id, 
                        original_url: urlParaEncurtar, 
                        meme_url: meme_url 
                    });

                if (error) throw error; // Se o Supabase retornar um erro, lança para o catch

                formCriarLink.reset();
                renderizarLinks(); // ATUALIZA A LISTA NA TELA INSTANTANEAMENTE!

            } catch (error) {
                alert(`Erro ao criar o link: ${error.message}`);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Encurtar URL';
            }
        });

        // Ações de Editar e Excluir agora também são instantâneas
        // (O resto do seu script com as lógicas de clique nos botões, modals e feedback de memes)
        // ...

        // --- INICIALIZAÇÃO ---
        renderizarLinks();
    </script>
</body>
</html>